## 前言

## 简介

git 开源的分布式版本控制系统（Distributed Version Control System, DVCS），用于跟踪和管理代码变更。

### 特点

1. 分布式：相对于 svn 不同的是，git 是一种分布式系统，git 允许开发者将代码完整的克隆到本地，这样开发者就可以在本地仓库上进行提交（commit）和分支（branch）操作，而不需要连接到服务器。

2. 高效：Git 使用了高效的数据结构来存储和管理数据，包括哈希（hash）对象和压缩技术，使得 Git 仓库通常比其他版本控制系统的仓库更小、更快。

3. 撤销及恢复：Git 提供了丰富的命令来撤销（undo）和恢复（redo）之前的操作，如 git revert、git reset 等，这使得开发者可以轻松地回滚到之前的某个状态，或者在需要时重新应用之前的更改。

4. 强大的社区和文档：Git 拥有一个活跃的社区和丰富的文档资源，包括官方文档、教程、书籍和博客文章等，这些资源为开发者提供了广泛的学习和支持。

### 区别

1. Git，GitHub 与 GitLab 的区别：
   - `Git` 是一种版本控制系统，是一种工具，用于代码的存储和版本控制。
   - `GitHub` 是一个基于 Git 实现的在线代码仓库，是目前全球最大的代码托管平台。
   - `GitLab` 是一个基于 Git 实现的在线代码仓库软件，你可以用 GitLab 自己搭建一个类似于 GitHub 一样的仓库，但是 GitLab 有完善的管理界面和权限控制，一般用于在企业、学校等内部网络搭建 Git 私服。

2. GitHub 和码云的异同：githup 是国外开发的代码托管平台，码云是国内的代码托管平台。

3. Git 和 SVN 的区别：git 是分布式管理工具，svn 是集中式管理工具，svn 依赖服务器去完成集中式管理，每个程序员都可以将自己的代码上传到服务器上，同时可以下载自己和同事的代码。当服务器出现问题是，所有人代码都会丢失。git 不需要服务器，每个人电脑上都有分布式管理的索引，可以看见自己和他人的上传和下载的记录和文件，即使一台电脑出现问题，其他人也会有记录，文件不会丢失。

### 分支规范

1. master ===> 主分支，所有提供给用户使用的正式版本，都在这个主分支上发布

2. feature/{jira 开发子任务名称}  例：feature/HOTP-635 ==>功能分支，某个功能点正在开发阶段，开发完成后提交到测试分支。测试完成后提交到发布分支。

3. release/& ==>发布分支，发布定期要上线的功能（开发完成后所有代码合并到此分支待发布上线）

4. release/publish==>测试分支，测试分支包含多个功能的测试阶段，值得注意的是多个 feature 分支的代码开发完成都会提交测试分支，这样做的原因是为了避免多个需求并行的情况下环境使用冲突。

5. hotfix/{bug jira 名称/日期} 例：hotfix/HOTP-803 ===>用于线上 bug 修复，注意此分支只能从 master 上拉取。

冲突解决：合并方式为 Merge Request，然后指定合并人 review 代码后进行合并。如果有冲突，找到冲突对应人进行解决后在提交。

## 分支命令

#### 初始化

1. `git init`：初始化

   > 解释：该命令将创建一个名为 .git 的子目录，这个子目录含有你初始化的 Git 仓库中所有的必须文件，这些文件是 Git 仓库的骨干。 但是，在这个时候，我们仅仅是做了一个初始化的操作，你的项目里的文件还没有被跟踪。

2. `git clone git@**\***`：克隆一个远程项目到本地

3. `git remote add origin git@**\***`：链接一个本地的项目到远程

#### 常见命令

1. `git add .` 把工作区修改的内容放到暂存区

2. `git commit -m '添加提交信息'` 把暂存区的内容提交到本地仓库

   > 解释：git commit -m 与-am 的区别：git commit -m 用于提交暂存区的文件，git commit -am 用于提交跟踪过的文件。

3. `git push` 把本地代码仓库的代码提交远程仓库

4. `git pull` 把远程的最新修改内容拉取到本地来

5. `git push origin` 把当前分支提交到远程

6. `git rm` 删除本地文件提交

7. `git log` 查看提交记录

8. `git status` 查看当前仓库的状态

#### 新建分支

1. `git checkout -b '分支名'`：新建一个本地分支并切换到新建的分支

2. `git branch '分支名'`：新建一个本地分支，并不切换分支

3. `git checkout -b '分支名' && git push --set-upstream orgin '分支名'`：新建一个远程分支

#### 查看分支

1. `git branch --all`：查看全部分支

2. `git branch `：仅查看本地分支

3. `git branch -r`：仅查看远程分支

#### 切换分支

1. `git checkout` 切换分支（远程有的分支，本地没有，也可以切换，切换完成后会在本地创建分支）

2. `git checkout -b '分支名'`： 新建并且切换分支

#### 合并分支

1. `git merge *` 把\*个分支合并到当前分支

#### 删除分支

1. `git branch -D '分支名'`：删除本地分支

2. `git push origin --delete '分支名'`：删除远程分支

#### 回退版本

1. `git reset --soft <版本号>` ：回退到指定 commit，但是保持暂存区和工作目录不变。

2. `git reset --mixed  <版本号>` ：同时重置暂存区，但保留工作目录中的更改。

3. `git reset --hard  <版本号>`：回退到指定 commit，同时重置暂存区和工作目录，丢弃自那次提交以来所有的更改。

4. `git reset <版本号>`：这种方式默认和`git reset --mixed  <版本号>`一样的。

#### 用户名及邮箱

1. `git config --global user.name 'mh'` 修改用户名

2. `git config --global user.email '1111@qq.com'` 修改邮箱

3. `git config user.name` 查看用户名

4. `git config user.email` 查看邮箱

#### 其他命令

1. `git remote update origin --prune` 更新远程分支列表

2. `git stash` 将当前的工作目录缓存到堆栈中

3. `git stash pop` 将堆栈中的缓存恢复到当前的工作目录 并删除堆栈中的缓存

4. `git stash list` 查看堆栈中的缓存

5. `git stash show` 显示做了那些改动

6. `git stash clear` 删除所有缓存的 stash
   > 对于新建的文件执行 stash 不生效，git stash 只对 git 版本控制的文件进行追踪，所以对于新建的文件先执行 git add . 后执行 git stash

## 忽略规则

前言：常见的 git 管理项目中会配置.gitignore 文件，这是 git 的配置文件。

#### 常见的配置规则

一、指定需要过滤的文件
（1）/mtk         过滤整个文件夹
（2）\*.zip       过滤所有.zip 文件
（3）/mtk/do.c   过滤某个具体文件

二、指定需要添加到 git 管理的文件
（1）!\*.zip
（2）!/mtk/one.txt

#### 场景

假如我们只需要管理/mtk/目录中的 one.txt 文件，这个目录中的其他文件都不需要管理，那么我们就需要使用：（1）/mtk/ （2）!/mtk/one.txt

#### 配置语法

以斜杠“/”开头表示目录；以星号“\*”通配多个字符；以问号“?”通配单个字符以方括号“[]”包含单个字符的匹配列表；以叹号“!”表示不忽略(跟踪)匹配到的文件或目录；
此外，git 对于 .ignore 配置文件是按行从上到下进行规则匹配的，意味着如果前面的规则匹配的范围更大，则后面的规则将不会生效；

git 规则配置了不生效的问题解决办法： 假如已经使用 git 版本控制追踪到 node_modules 文件，但是在此之前没有配置.gitignore 规则过滤 node_modules 文件，此时再去配置规则，提交的时候 git 仍然可以追踪到 node_modules。解决办法：删除 node_modules 文件，提交后重新配置规则。

## 常见问题

#### 1. git branch -r 显示不是最新的远程分支,怎么解决?

> git branch -r 命令不会每次都获取最新的远程厂库分支，解决方法： 使用 git fetch 命令更新分支，然后再使用 git branch -r 即可查看到最新的远程分支

#### 2. git fetch 和 git pull 的区别？

> git fetch 作用：将远程最新的内容拉到本地，包括远程新建的分支，并不执行合并。
> git pull 作用：将远程最新内容拉到本地，并执行合并，此时可能出现分支冲突。
> 总结：git pull = git fetch + git merge

#### 3. 如何提交部分代码？

> 在真实的项目开发过程中，可能会遇到一个需求涉及到多处改动。比如：在开发完模块一的时候，由于接口没有及时提供，无法进行联调，这个时候大多数会选择先开发模块二，当模块二开发一半的时候，模块一的接口好了，又不得不进行模块一的联调。这样就会导致一个需求中的多个模块开发完成的时间不同。那么就会出现当模块一联调完成，提交代码时候我只想提交模块一的代码，不想提交模块二未完成的代码。具体的操作有以下几种：

- 使用 git add 命令提交单个文件或者多个文件，可以运行以下命令：git add file1.js file2.js
- 使用 git add 命令提交目录下所有更改，例如，要提交 "src" 目录下的所有更改，可以运行以下命令：git add src/ 或者 git add src 选中 src 目录，在集成终端中打开，然后使用 git add . 那么这样也是提交的 src 目录下所有子目录。

#### 4. git commit 后，如何撤销 commit 内容？####

解决方案使用 git reset 回退，具体有两种方式：

git reset --soft HEAD^ ===> 不删除改动的代码，撤销 commit，不撤销 git add .

git reset --hard HEAD^ ===> 删除改动的代码，撤销 commit，同时撤销 git add .

#### 5. git 中本地仓库和远程仓库的区别？

- 存储位置不同：本地仓库存储在个人的计算机中，而远程仓库存储在网络服务器上。
- 权限访问不同：本地仓库只能开发者本人访问，而远程仓库是可以多人协作。
- git 本身是分布式版本控制系统：所以本地仓库和远程仓库都可以独立存在并进行版本控制和修改。
- 总体来说：本地仓库一般用于保存个人代码测试和临时代码，远程仓库用于多人协作和代码备份。

#### 6. 如何断开原来原程仓库链接新仓库？

- 查看远程连接 `git remote -v`
- 取消与之前远程仓库的连接 `git remote remove origin`
- 初始化仓库 `git init`
- 连接新仓库 `git remote add origin https://github.com/XXX.git`

#### 7. git 合并冲突你喜欢用 merge 还是 rebase？
